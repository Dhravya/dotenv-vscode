/*
  DONE: 
    - Full line comments
    - Keys with/without export
    - Values
      - Double quoted strings with interpolation
      - Variable interpolation
      - Comments at the end of values
  TODO: 
      - Single quoted strings with no interpolation
      - Multi-line values
      - Escape characters in double quotes
*/

{
  "scopeName": "source.dotenv",
  "patterns": [
    {
     "comment": "Full Line Comment",
     "match": "^\\s?(#.*$)\\n",
     "captures": {
      "1": {
        "patterns": [
          {
            "include": "#line comment"
          }
        ] 
      }
     }
    },
    {
      "comment": "ENV entry",
      "match": "^\\s?(.*)\\s?(\\=)(.*)$",
      "captures": {
        "1": {
          "patterns": [
            {
              "include": "#key"
            }
          ]
        },
        "2": {
          "name": "keyword.operator.assignment.dotenv"
        },
        "3": {
          "patterns": [
            {
              "include": "#line comment"
            },
            {
              "include": "#double quoted string"
            },
            {
              "include": "#interpolation"
            }
          ]
        }
      }
    }
  ],

  "repository": {
    "variable": {
      "comment" : "env variable",
      "match": "[a-zA-Z_]+[a-zA-Z0-9_]*"
    },
    "line comment": {
      "comment": "Comment",
      "match": "#.*$",
      "name": "comment.line.dotenv"
    },
    "interpolation": {
      "comment": "Interpolation (variable substitution)",
      "match": "(\\$\\{)(.*)(\\})",
      "captures": {
        "1": {
          "name": "keyword.interpolation.open.dotenv"
        },
        "2": {
          "name": "variable.interpolation.dotenv"
        },
        "3": {
          "name": "keyword.interpolation.close.dotenv"
        }
      }
    },
    "double quoted string": {
      "comment": "Double Quoted String",
      "match": "\"(.*)\"",
      "name": "string.quoted.double.dotenv",
      "captures": {
        "1": {
          "patterns": [
            {
              "include": "#interpolation"
            }
          ]
        }
      }
    },
    "key": {
      "comment": "Key",
      "match": "(export\\s)?(.*)",
      "captures": {
        "1": {
          "name": "keyword.key.export.dotenv"
        },
        "2": {
          "name": "variable.key.dotenv",
          "patterns": [
            {
              "include": "#variable"
            }
          ]
        }
      }
    }

  }
}